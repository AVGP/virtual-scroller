<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
  <select id="containerEl">
    <option value="template">&lt;template&gt;</option>
    <option value="div">&lt;div&gt;</option>
  </select>
  x
  <input id="countEl" type="number" value="5" min="1" max="50">
  <label>attach?
    <input id="attachEl" type="checkbox">
  </label>
  <label>hidden?
    <input id="hiddenEl" type="checkbox">
  </label>
  <button onclick="runTest(containerEl.value, countEl.valueAsNumber, attachEl.checked, hiddenEl.checked)">run test</button>
  <pre id="outEl"></pre>
  <script type="module">

    let html = '';
    fetch('https://html.spec.whatwg.org/')
      .then(r => r.text())
      .then((resp) => html = resp);

    const wait = () => new Promise(r => requestAnimationFrame(() => requestIdleCallback(r)));
    window.runTest = async (type, count, attach, hidden) => {
      outEl.textContent += `<${type}> x ${count}, attach? ${attach} hidden? ${hidden}\n\n`;
      let sum = 0;
      for (let i = 0; i < count; i++) {
        const el = document.createElement(type);
        el.style.display = hidden ? 'none' : null;
        attach && document.body.appendChild(el);
        await wait();
        const start = performance.now();
        el.innerHTML = html;
        // Force layout and paint.
        el.offsetHeight;
        getComputedStyle(el).height;
        const time = performance.now() - start;
        sum += time;
        outEl.textContent += `#${i + 1}\t${time.toFixed(2)}\n`;
        // Cleanup.
        el.remove();
      }
      outEl.textContent += `\navg\t${(sum / count).toFixed(2)}\n\n`;
    };
  </script>
</body>

</html>